
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>10. Named Entity Recognition &#8212; Text and Data Mining Tutorial</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="11. Differences and similarities" href="11%20Differences_and_Similarities.html" />
    <link rel="prev" title="9. Diction" href="9%20Diction.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Text and Data Mining Tutorial</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Welcome.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorial
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1%20Acquiring%20texts.html">
   1. Acquiring texts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2%20Tokenisation.html">
   2. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3%20Word%20frequencies.html">
   3. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4%20Examining_context.html">
   4. Examining the context of words
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5%20Type-token_ratio.html">
   5. Type-token ratio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6%20NLP.html">
   6. NLP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7%20Sentiment_analysis.html">
   7. Sentiment analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8%20Lexicons.html">
   8. Lexicons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="9%20Diction.html">
   9. Diction
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   10. Named Entity Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11%20Differences_and_Similarities.html">
   11. Differences and similarities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12%20Topic%20modelling.html">
   12. Topic modelling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Solutions to the exercises
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/1%20Acquiring%20texts.html">
   1. Acquiring texts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/2%20Tokenisation.html">
   2. Tokenisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/3%20Word%20frequencies.html">
   3. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/4%20Examining_context.html">
   4. Examining context
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/5%20Type-token_ratio.html">
   5. Type-token ratio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/6%20NLP.html">
   6. NLP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/7%20Sentiment_analysis.html">
   7. Sentiment analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/8%20Lexicons.html">
   8. Lexicons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/9%20Diction.html">
   9. Diction
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/10 Named_Entity_Recognition.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/cdsleiden/tdm-tutorial/gh-pages?urlpath=tree/docs/notebooks/10 Named_Entity_Recognition.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#spacy">
   spaCy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-ner-tags-in-longer-texts">
   Finding NER tags in longer texts
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="named-entity-recognition">
<h1>10. Named Entity Recognition<a class="headerlink" href="#named-entity-recognition" title="Permalink to this headline">¶</a></h1>
<p>A named entity is an object, person, location or organization which has been assigned a proper name. <em>Named Entity Recognition</em> is a computational technique that seeks to identify all the named entities that that are mentioned within texts. Applications making use of Named Entity Recognition can generally extract the most of the occurrences of such named entities and it can also characterise such entities using pre-defined categories such as ‘Person’, ‘Location’, ‘Work of Art’, ‘Organisation’.</p>
<p>Named Entity Recognition applications typically make use of statistical models created using Machine Learning algorithms. Such models are often trained using large numbers of texts in which all the people, locations, organisations and named objects have been labelled manually by human readers. On the basis of a careful analysis of the frequencies and the contexts of all of these named entitities, computers can eventually be enabled to recognise similar types of entitities in new, unlabelled texts.</p>
<div class="section" id="spacy">
<h2>spaCy<a class="headerlink" href="#spacy" title="Permalink to this headline">¶</a></h2>
<p>This notebook explains how you can work with Named Entity Recognition using an NLP library named <em>spaCy</em>. For more information on how to install <em>spaCy</em>, or on how to load specific langauge models, please read the notebook on <em>NLP</em>.</p>
<p><em>spaCy</em> offers support for a wide range of languages. The model for the English language was trained on the basis of an large annotated corpus named <em><a class="reference external" href="https://catalog.ldc.upenn.edu/LDC2013T19">OntoNotes</a></em>. This model can be downloaded using the following command.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>python -m spacy download en_core_web_sm
</pre></div>
</div>
</div>
</div>
<p>After the model has been downloaded, it needs to be  loaded, so that you can work with it in your code. The <code class="docutils literal notranslate"><span class="pre">load()</span></code> method in <code class="docutils literal notranslate"><span class="pre">spaCy</span></code> creates a new object which can be used to add linguistic and semantic annotations. Ii the code below, is object is given the name <code class="docutils literal notranslate"><span class="pre">nlp</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">nlp</span></code> object can annotate a given string in a number of ways. SpaCy can be used not only to describe properties such as the parts of speech and the lemmatised versions of words, but also find the named entities.
In the code below, the output of the <code class="docutils literal notranslate"><span class="pre">nlp()</span></code> method is assigned to a variable named <code class="docutils literal notranslate"><span class="pre">tagged_text</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tagged_text</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="s2">&quot;James Joyce (born February 2, 1882, Dublin, Ireland - died January 13, 1941, Zürich, Switzerland) was Irish novelist noted for his experimental use of language and exploration of new literary methods in such large works of fiction as Ulysses (1922) and Finnegans Wake (1939).&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The tags added by <code class="docutils literal notranslate"><span class="pre">nlp()</span></code> can be visualised effectively using the <code class="docutils literal notranslate"><span class="pre">render()</span></code> method from the <code class="docutils literal notranslate"><span class="pre">displacy</span></code> module. When you add the parameter <code class="docutils literal notranslate"><span class="pre">style</span></code>, with value <code class="docutils literal notranslate"><span class="pre">ent</span></code>, this visulation concentrates on the named entities that have been found.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">spacy</span> <span class="kn">import</span> <span class="n">displacy</span>
<span class="n">displacy</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">tagged_text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;ent&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em>spaCy</em> works with the following pre-defined NER labels:</p>
<ul class="simple">
<li><p>PERSON: People, including fictional</p></li>
<li><p>NORP: Nationalities or religious or political groups</p></li>
<li><p>FAC: Buildings, airports, highways, bridges, etc.</p></li>
<li><p>ORG: Companies, agencies, institutions, etc.</p></li>
<li><p>GPE: Countries, cities, states</p></li>
<li><p>LOC: Non-GPE locations, mountain ranges, bodies of water</p></li>
<li><p>PRODUCT: Objects, vehicles, foods, etc. (not services)</p></li>
<li><p>EVENT: Named hurricanes, battles, wars, sports events, etc.</p></li>
<li><p>WORK_OF_ART: Titles of books, songs, etc.</p></li>
<li><p>LAW: Named documents made into laws.</p></li>
<li><p>LANGUAGE: Any named language</p></li>
<li><p>DATE: Absolute or relative dates or periods</p></li>
<li><p>TIME: Times smaller than a day</p></li>
<li><p>PERCENT: Percentage, including “%”</p></li>
<li><p>MONEY: Monetary values, including unit</p></li>
<li><p>QUANTITY: Measurements, as of weight or distance</p></li>
<li><p>ORDINAL: “first”, “second”, etc.</p></li>
<li><p>CARDINAL: Numerals that do not fall under another type</p></li>
</ul>
<p>The meaning of specifc <em>spaCy</em> codes can be found the <code class="docutils literal notranslate"><span class="pre">explain()</span></code> method, as is demonstated in the following code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PERSON&#39;</span><span class="p">,</span><span class="s1">&#39;NORP&#39;</span><span class="p">,</span><span class="s1">&#39;FAC&#39;</span><span class="p">,</span><span class="s1">&#39;ORG&#39;</span><span class="p">,</span><span class="s1">&#39;GPE&#39;</span><span class="p">,</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span><span class="s1">&#39;PRODUCT&#39;</span><span class="p">,</span><span class="s1">&#39;EVENT&#39;</span><span class="p">,</span><span class="s1">&#39;WORK_OF_ART&#39;</span><span class="p">,</span><span class="s1">&#39;LAW&#39;</span><span class="p">,</span><span class="s1">&#39;LANGUAGE&#39;</span><span class="p">,</span><span class="s1">&#39;DATE&#39;</span><span class="p">,</span><span class="s1">&#39;TIME&#39;</span><span class="p">,</span><span class="s1">&#39;PERCENT&#39;</span><span class="p">,</span><span class="s1">&#39;MONEY&#39;</span><span class="p">,</span><span class="s1">&#39;QUANTITY&#39;</span><span class="p">,</span><span class="s1">&#39;ORDINAL&#39;</span><span class="p">,</span><span class="s1">&#39;CARDINAL&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span> 
    <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">spacy</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="si">}</span><span class="s1"> &#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="finding-ner-tags-in-longer-texts">
<h2>Finding NER tags in longer texts<a class="headerlink" href="#finding-ner-tags-in-longer-texts" title="Permalink to this headline">¶</a></h2>
<p>One important limitation of the <em>spaCy</em> tagger is that it can only be applied to texts consisting of less than 1,000,000 characters. The parser roughly requires 1GB of memory per 100,000 characters, and texts containing more than 1,000,000 characters tends to cause memory allocation errors.</p>
<p>The code below tries to avoid such errors. It safely sets the <code class="docutils literal notranslate"><span class="pre">max_length</span></code> of the texts to be parsed to 500,000. The code divides the full text into segments, each of which are shorter than this <code class="docutils literal notranslate"><span class="pre">max_length</span></code>.</p>
<p>After this, these shorter segments are all parsed one by one. These tagged texts are stored in a dictionary named <code class="docutils literal notranslate"><span class="pre">tagged_segments</span></code>.</p>
<p>Tagging texts of ca. 500,000 characters still demands quite some memory space. The code below may take some time to complete because of this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">nltk.tokenize</span> <span class="kn">import</span> <span class="n">sent_tokenize</span>

<span class="n">segments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">tagged_segments</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">segment_nr</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;ARoomWithAView.txt&#39;</span>
<span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;Corpus&#39;</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">text</span> <span class="p">)</span>
<span class="n">max_length</span> <span class="o">=</span> <span class="mi">500000</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
    <span class="n">full_text</span> <span class="o">=</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;Total number of characters in </span><span class="si">{</span><span class="n">text</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">full_text</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span>

<span class="n">sentences</span> <span class="o">=</span> <span class="n">sent_tokenize</span><span class="p">(</span><span class="n">full_text</span><span class="p">)</span>

<span class="n">length</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="n">segment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
    <span class="n">length</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="n">max_length</span><span class="p">:</span>
        <span class="n">segment</span> <span class="o">+=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">segments</span><span class="p">[</span><span class="n">segment_nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span>
        <span class="n">segment</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">segment_nr</span> <span class="o">+=</span> <span class="mi">1</span>
        
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">segments</span><span class="p">[</span><span class="n">segment_nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">segment</span>
    

<span class="nb">print</span><span class="p">(</span> <span class="s1">&#39;Annotating the text segments ... &#39;</span><span class="p">)</span>    
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">tagged_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">segments</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The annotated texts can be analysed in a variety of ways. The code below lists the personal names that are mentioned most frequently in the text.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tdm</span> <span class="kn">import</span> <span class="n">sortedByValue</span>

<span class="n">freq</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">tagged_segments</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">named_entity</span> <span class="ow">in</span> <span class="n">tagged_segments</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">named_entity</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;PERSON&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">named_entity</span><span class="p">)</span> 
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">freq</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span> <span class="n">sortedByValue</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">freq</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To view all the works of art that are referred to in the texts, for instance, you need to replace the label ‘PERSON’ in the code below with the tag ‘WORK_OF_ART’.</p>
<p>The NER parser, as mentioned, also tried to identify the locations that are mentioned in the text. The locations are assigned the code ‘GPE’. Once we have identified the geographical locations that are mentioned in a text, we can also try to visualise all of these locations on a map.</p>
<p>The code below firstly stores all the locations that are found by <em>scraPy</em> in a list named <code class="docutils literal notranslate"><span class="pre">locations</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tdm</span> <span class="kn">import</span> <span class="n">sortedByValue</span>

<span class="n">freq</span> <span class="o">=</span> <span class="nb">dict</span>
<span class="n">locations</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">tagged_segments</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">named_entity</span> <span class="ow">in</span> <span class="n">tagged_segments</span><span class="p">[</span><span class="n">doc</span><span class="p">]</span><span class="o">.</span><span class="n">ents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">named_entity</span><span class="o">.</span><span class="n">label_</span> <span class="o">==</span> <span class="s1">&#39;GPE&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">named_entity</span><span class="p">)</span> 
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">locations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        
<span class="n">locations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span> <span class="p">)</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The Named Entity Recognition process certainly does not function flawlessly. It probabaly misses some of the locations that are mentioned in the text, and it is also likely that it will have labelled some non-locations as locations. If necessary, you can edit the <code class="docutils literal notranslate"><span class="pre">locations</span></code> list that is created manually, making us of the <code class="docutils literal notranslate"><span class="pre">remove()</span></code> method, for instance.</p>
<p>The following code tries to find the geographic coordinates (i.e. the longitude and the latitude) of the items listed in <code class="docutils literal notranslate"><span class="pre">locations</span></code>, using the <code class="docutils literal notranslate"><span class="pre">openStreetMap</span></code> API.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">remove_brackets</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="s1">&#39;(\[)|(\])&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">,</span> <span class="n">text</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>

<span class="n">locations_coord</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">loc</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">locations_coord</span><span class="p">:</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://nominatim.openstreetmap.org/search?q=&#39;</span><span class="o">+</span> <span class="n">loc</span> <span class="o">+</span> <span class="s1">&#39;&amp;format=xml&#39;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="s1">&#39;\s+&#39;</span> <span class="p">,</span> <span class="s1">&#39;%20&#39;</span> <span class="p">,</span> <span class="n">url</span> <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">url</span> <span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="p">)</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;place&#39;</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">el</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">place</span> <span class="ow">in</span> <span class="n">el</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="n">place</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span>
                <span class="n">lon</span> <span class="o">=</span> <span class="n">place</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">locations_coord</span><span class="p">[</span> <span class="n">loc</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">lat</span> <span class="p">,</span> <span class="n">lon</span> <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loc</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
     
</pre></div>
</div>
</div>
</div>
<p>Finally, the locations are drawn on a map using <code class="docutils literal notranslate"><span class="pre">Leaflet</span></code>, A Javascript library for creating interactive maps.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="s1">&#39;map.html&#39;</span> <span class="p">,</span> <span class="s1">&#39;w&#39;</span> <span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;!DOCTYPE html&gt;</span>
<span class="s1">&lt;html&gt;</span>
<span class="s1">&lt;head&gt;</span>

<span class="s1">                &lt;title&gt;Locations&lt;/title&gt;</span>

<span class="s1">                &lt;meta charset=&quot;utf-8&quot; /&gt;</span>
<span class="s1">                &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span>

<span class="s1">                &lt;link rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; href=&quot;docs/images/favicon.ico&quot; /&gt;</span>

<span class="s1">    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.7.1/dist/leaflet.css&quot; integrity=&quot;sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==&quot; crossorigin=&quot;&quot;/&gt;</span>
<span class="s1">    &lt;script src=&quot;https://unpkg.com/leaflet@1.7.1/dist/leaflet.js&quot; integrity=&quot;sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==&quot; crossorigin=&quot;&quot;&gt;&lt;/script&gt;</span>



<span class="s1">&lt;/head&gt;</span>
<span class="s1">&lt;body&gt;</span>





<span class="s1">&lt;div id=&quot;mapid&quot; style=&quot;width: 600px; height: 400px;&quot;&gt;&lt;/div&gt;</span>
<span class="s1">&lt;script&gt;</span>

<span class="s1">                var mymap = L.map(&#39;mapid&#39;).setView([52.0799838, 4.3113461], 4);</span>

<span class="s1">                L.tileLayer(&#39;https://api.mapbox.com/styles/v1/</span><span class="si">{id}</span><span class="s1">/tiles/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw&#39;, {</span>
<span class="s1">                                maxZoom: 18,</span>
<span class="s1">                                attribution: &#39;Map data &amp;copy; &lt;a href=&quot;https://www.openstreetmap.org/&quot;&gt;OpenStreetMap&lt;/a&gt; contributors, &#39; +</span>
<span class="s1">                                                &#39;&lt;a href=&quot;https://creativecommons.org/licenses/by-sa/2.0/&quot;&gt;CC-BY-SA&lt;/a&gt;, &#39; +</span>
<span class="s1">                                                &#39;Imagery  &lt;a href=&quot;https://www.mapbox.com/&quot;&gt;Mapbox&lt;/a&gt;&#39;,</span>
<span class="s1">                                id: &#39;mapbox/streets-v11&#39;,</span>
<span class="s1">                                tileSize: 512,</span>
<span class="s1">                                zoomOffset: -1</span>
<span class="s1">                }).addTo(mymap); </span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locations_coord</span><span class="p">:</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="p">,</span> <span class="s1">&#39;&#39;</span> <span class="p">,</span> <span class="n">l</span> <span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39; L.marker([ </span><span class="si">{</span> <span class="n">locations_coord</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="si">}</span><span class="s1">, </span><span class="si">{</span> <span class="n">locations_coord</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="si">}</span><span class="s1">  ]).addTo(mymap) &#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot; .bindPopup(&#39;</span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">.&#39;) &quot;</span><span class="p">)</span>  
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="s1">&#39;;&#39;</span> <span class="p">)</span>
    
<span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">&lt;/script&gt;</span>



<span class="sd">&lt;/body&gt;</span>
<span class="sd">&lt;/html&gt;</span>

<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">exists</span>

<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span> <span class="s1">&#39;map.html&#39;</span> <span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cdsleiden/tdm-tutorial",
            ref: "gh-pages",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="9%20Diction.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">9. Diction</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="11%20Differences_and_Similarities.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">11. Differences and similarities</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Peter Verhaar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>