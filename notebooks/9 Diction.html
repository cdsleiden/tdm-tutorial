
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>9. Diction &#8212; Text and Data Mining Tutorial</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="1. Acquiring texts" href="Solutions/1%20Acquiring%20texts.html" />
    <link rel="prev" title="8. Lexicons" href="8%20Lexicons.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Text and Data Mining Tutorial</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Welcome.html">
   Welcome
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tutorial
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="1%20Acquiring%20texts.html">
   1. Acquiring texts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="2%20Tokenisation.html">
   2. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="3%20Word%20frequencies.html">
   3. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="4%20Examining_context.html">
   4. Examining the context of words
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="5%20Type-token_ratio.html">
   5. Type-token ratio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="6%20NLP.html">
   6. NLP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="7%20Sentiment_analysis.html">
   7. Sentiment analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="8%20Lexicons.html">
   8. Lexicons
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   9. Diction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Solutions to the exercises
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/1%20Acquiring%20texts.html">
   1. Acquiring texts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/2%20Tokenisation.html">
   2. Tokenisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/3%20Word%20frequencies.html">
   3. Word frequencies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/4%20Examining_context.html">
   4. Examining context
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/5%20Type-token_ratio.html">
   5. Type-token ratio
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/6%20NLP.html">
   6. NLP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/7%20Sentiment_analysis.html">
   7. Sentiment analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/8%20Lexicons.html">
   8. Lexicons
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Solutions/9%20Diction.html">
   9. Diction
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/9 Diction.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/cdsleiden/tdm-tutorial/gh-pages?urlpath=tree/docs/notebooks/9 Diction.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   9. Diction
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-subcorpora">
     Defining ‘subcorpora’
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculating-frequencies">
   Calculating frequencies
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dunning-s-log-likelihood">
     Dunning’s log likelihood
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mann-whitney-formula">
     Mann Whitney formula
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bibliography">
     Bibliography
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise-9-1">
     Exercise 9.1
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="diction">
<h1>9. Diction<a class="headerlink" href="#diction" title="Permalink to this headline">¶</a></h1>
<p>The term ‘diction’ generally refers to the stylistic choices that are made by an author while writing a text. A study of the diction of an author may concentrate, among other things, on the words that are chosen. In stylometric research, it can be interesting to study the words that are characteristic of a given author, and to examine how the words that are chosen by one author differ from the words chosen by other authors.</p>
<p>This notebook explains how you can corpare the words in two different text, and how you can identify the words that are distinctive within each of these texts.</p>
<div class="section" id="defining-subcorpora">
<h2>Defining ‘subcorpora’<a class="headerlink" href="#defining-subcorpora" title="Permalink to this headline">¶</a></h2>
<p>This notebook explains how you can corpare the words in two ‘subcorpora’. Within the overarching corpus, you may have collected texts by two different authors or texts in two different genres, or texts from different periods. The code below firstly enables you to define such subcorpora. In the lists that are  named <code class="docutils literal notranslate"><span class="pre">corpus1</span></code> and <code class="docutils literal notranslate"><span class="pre">corpus2</span></code>, you need to list all the texts from the two subcorpora whoe words you want to compare.</p>
<p>The code in this notebook carries out a comparative analysis of the diction in two novels only: *Through the Looking Glass and <em>Ulysses</em>. The former test is added as an item to <code class="docutils literal notranslate"><span class="pre">corpus1</span></code>, and the second text is appended to <code class="docutils literal notranslate"><span class="pre">corpus2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;Corpus&#39;</span>

<span class="n">corpus1</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;ThroughtheLookingGlass.txt&#39;</span> <span class="p">]</span>
<span class="n">corpus2</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;HeartofDarkness.txt&#39;</span> <span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="calculating-frequencies">
<h1>Calculating frequencies<a class="headerlink" href="#calculating-frequencies" title="Permalink to this headline">¶</a></h1>
<p>The code in the cell below reads in the full text of the files that are listed in <code class="docutils literal notranslate"><span class="pre">corpus1</span></code>. In this case, we are dealing with one text file only. Next, we calculate the frequencies of all of these words. These frequencies are stored in a dictionary named <code class="docutils literal notranslate"><span class="pre">freq1</span></code>.</p>
<p>Once the first subcorpus has been processed, the code does the same for the texts in <code class="docutils literal notranslate"><span class="pre">corpus2</span></code>. The word frequencies are placed in a dictionary named <code class="docutils literal notranslate"><span class="pre">freq2</span></code>.</p>
<p>After running this code, the variable <code class="docutils literal notranslate"><span class="pre">full_text1</span></code> will contain the <em>complete</em> texts of all the texts in <code class="docutils literal notranslate"><span class="pre">corpus1</span></code>. The dictionary named <code class="docutils literal notranslate"><span class="pre">freq1</span></code> will contain the frequencies of all the words in this full text.</p>
<p>The variables <code class="docutils literal notranslate"><span class="pre">full_text2</span></code> and <code class="docutils literal notranslate"><span class="pre">freq2</span></code> store the same type of information for the texts in <code class="docutils literal notranslate"><span class="pre">corpus2</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tdmh</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">nltk</span> <span class="kn">import</span> <span class="n">word_tokenize</span>

<span class="kn">from</span> <span class="nn">nltk.corpus</span> <span class="kn">import</span> <span class="n">stopwords</span>

<span class="n">stopwords</span> <span class="o">=</span> <span class="n">stopwords</span><span class="o">.</span><span class="n">words</span><span class="p">(</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">full_text</span><span class="p">)</span>
    <span class="n">new_list</span><span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">new_list</span>


<span class="n">freq1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">full_text1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">corpus1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; ... &#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="nb">dir</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">full_text1</span> <span class="o">+=</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

<span class="n">words</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span> <span class="n">full_text1</span>  <span class="p">)</span>

<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">freq1</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
    
        
        
<span class="n">freq2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">full_text2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    
<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">corpus2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; ... &#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="nb">dir</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">full_text2</span> <span class="o">+=</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

<span class="n">words</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span>  <span class="n">full_text2</span> <span class="p">)</span>

<span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
    <span class="n">freq2</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span><span class="mi">1</span>
    
</pre></div>
</div>
</div>
</div>
<div class="section" id="dunning-s-log-likelihood">
<h2>Dunning’s log likelihood<a class="headerlink" href="#dunning-s-log-likelihood" title="Permalink to this headline">¶</a></h2>
<p>One of statistical methods that can be used to find such distinctive words is <em>Dunning’s log likelihood</em>. In short, it analyses the distinctiveness of word in one set of texts compared to the texts in a reference corpus, by calculating probabilities based on word frequencies. A good explanation of the fomula can be found on the <a class="reference external" href="https://wordhoard.northwestern.edu/userman/analysis-comparewords.html#loglike">wordHoard</a> website.</p>
<p>Using the frequencies that have been calculated above, the Dunning log likelihood scores are calculated for all of the words that occur both in <code class="docutils literal notranslate"><span class="pre">corpus1</span></code> and <code class="docutils literal notranslate"><span class="pre">corpus2</span></code> in the cell below. The actual calculation takes place in a method named <code class="docutils literal notranslate"><span class="pre">log_likelihood()</span></code>. The scores that are calculated are all stored in a dictionary named <code class="docutils literal notranslate"><span class="pre">ll_scores</span></code></p>
<p>The formula that is implemented in the <code class="docutils literal notranslate"><span class="pre">log_likelihood</span></code> method returns a number which can either be positive or negative. A postive score indicates that there is a high probability that the word will be used in the first corpus. A negative probability indicates that occurence of the word is more common in the second corpus. The tokens that are assigned the highest scores, in other words, are also most distincive of the first corpus.</p>
<p>The code below lists the 25 words that are assigned a positive log likelihood score in the first corpus.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span> <span class="n">word_count1</span> <span class="p">,</span> <span class="n">word_count2</span><span class="p">,</span> <span class="n">total1</span> <span class="p">,</span> <span class="n">total_2</span> <span class="p">):</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">word_count1</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">word_count2</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">total1</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">total2</span>
 
    <span class="n">perc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">perc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="n">polarity</span> <span class="o">=</span> <span class="n">perc1</span> <span class="o">-</span> <span class="n">perc2</span>
 
    <span class="n">E1</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">)</span>
    <span class="n">E2</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">)</span>
    
    <span class="n">ln1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">E1</span><span class="p">)</span>
    <span class="n">ln2</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="n">E2</span><span class="p">)</span>
    <span class="n">G2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">a</span><span class="o">*</span> <span class="n">ln1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span> <span class="n">ln2</span><span class="p">))</span>
    
    <span class="c1">#if polarity &lt; 0:</span>
    <span class="c1">#    G2 = -G2</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">E1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">G2</span> <span class="o">=</span> <span class="o">-</span><span class="n">G2</span>

    <span class="k">return</span> <span class="n">G2</span>



<span class="n">ll_scores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="n">total1</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">total2</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">for</span> <span class="n">word1</span> <span class="ow">in</span> <span class="n">freq1</span><span class="p">:</span>
    <span class="n">total1</span> <span class="o">+=</span> <span class="n">freq1</span><span class="p">[</span><span class="n">word1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">word2</span> <span class="ow">in</span> <span class="n">freq2</span><span class="p">:</span>
    <span class="n">total2</span> <span class="o">+=</span> <span class="n">freq2</span><span class="p">[</span><span class="n">word2</span><span class="p">]</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">freq1</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">freq2</span><span class="p">:</span>

        <span class="n">ll_score</span> <span class="o">=</span> <span class="n">log_likelihood</span><span class="p">(</span> <span class="n">freq1</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">,</span> <span class="n">freq2</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">,</span> <span class="n">total1</span> <span class="p">,</span> <span class="n">total2</span> <span class="p">)</span>
        <span class="n">ll_scores</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">ll_score</span>

<span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> 
        
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span><span class="n">ll_scores</span> <span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span> <span class="n">word</span> <span class="p">,</span> <span class="n">ll_scores</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span> 
        <span class="k">break</span>        
</pre></div>
</div>
</div>
</div>
<p>Words with negative log likelihood scores are more likely to appear in the reference corpus (i.e. the second corpus) than in the first corpus.</p>
<p>The code below lists the 25 words with the highest negative scores.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> 

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span><span class="n">ll_scores</span> <span class="p">)</span> <span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span> <span class="n">word</span> <span class="p">,</span> <span class="n">ll_scores</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
        <span class="k">break</span>   
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mann-whitney-formula">
<h2>Mann Whitney formula<a class="headerlink" href="#mann-whitney-formula" title="Permalink to this headline">¶</a></h2>
<p>In a <a class="reference external" href="https://tedunderwood.com/2011/11/09/identifying-the-terms-that-characterize-an-author-or-genre-why-dunnings-may-not-be-the-best-method/">blogpost on identifying literary diction</a>, Ted Underwood argues that Dunning’s log likelihood function also has a number of disadvantages. It is sensitive to outliers, for example. He explains that the Mann Whitney ranks test can be a good alternative.</p>
<p>To perform the Mann-Whitney ranks test, we firstly need to find all the words the two corpora to be compared have in common. Next, we need to divide the full texts of the two corpora to be compared into smaller chuncks, all of the same size. These can be fragments of 500 words, for instance. Next, we need to count the number of times each word occurs in these chunks. Using these counts, we can determine whether the word is more frequent in corpus 1 than in corpus 2 (or vice versa). As a final step, we determine the total number of fragments in which the word is most frequent, both in the first and the second corpus. If it is found, using these steps, that a word is much more common in one of the two corpora, this word can be identified as a distinctive word. The Mann-Whitney ranks test really looks at occurrences across the whole corpus, and it is neutralises the effect of exceptionally high counts in one or two of these chunks.</p>
<p>The Mann Whitney test can be performed in Python using the <code class="docutils literal notranslate"><span class="pre">mannwhitneyu()</span></code> method from the <code class="docutils literal notranslate"><span class="pre">scipy.stats</span></code> module.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span>

<span class="c1">## make a list of all the words in both corpora</span>
<span class="n">words1</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text1</span><span class="p">)</span>
<span class="n">words2</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">divide_into_chunks</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>

    <span class="n">chunks</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">## chunk contains dictionaries</span>
    <span class="c1"># with word frequencies</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">),</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chunks</span>


<span class="n">length</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">chunks1</span> <span class="o">=</span> <span class="n">divide_into_chunks</span><span class="p">(</span><span class="n">words1</span><span class="p">,</span><span class="n">length</span><span class="p">)</span>
<span class="n">chunks2</span> <span class="o">=</span> <span class="n">divide_into_chunks</span><span class="p">(</span><span class="n">words2</span><span class="p">,</span><span class="n">length</span><span class="p">)</span>


<span class="c1"># vocab is the union of terms in both sets</span>
<span class="n">all_words</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">all_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="n">all_words</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">all_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="n">all_words</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
<span class="n">rho</span> <span class="o">=</span>  <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">all_words</span><span class="p">:</span>
        
    <span class="n">a</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">b</span><span class="o">=</span><span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks1</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks2</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">stat</span><span class="p">,</span><span class="n">pval</span><span class="o">=</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">if</span> <span class="n">stat</span> <span class="o">&lt;=</span> <span class="n">mean</span><span class="p">:</span>
        <span class="n">pval</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">pval</span>
            
    <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span> <span class="n">pval</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The words that are most distinctive in corpus 1 have a negative value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;The following words are most distinctive in corpus 1:&quot;</span> <span class="p">)</span>  

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span> <span class="n">rho</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="si">:</span><span class="s1">.22f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span> 
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
<p>The words that are most distinctive in corpus 2 have a negative value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;The following words are most distinctive in corpus 2:&quot;</span>  <span class="p">)</span>  

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="si">:</span><span class="s1">.22f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span> 
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bibliography">
<h2>Bibliography<a class="headerlink" href="#bibliography" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Dunning, Ted, ‘Accurate Methods for the Statistics of Surprise and Coincidence’, in <em>Computational Linguistics</em>, 19:1 (1993).</p></li>
<li><p>Rayson, P. and Garside, R., ‘Comparing corpora using frequency profiling’, in <em>Proceedings of the workshop on Comparing Corpora, held in conjunction with the 38th annual meeting of the Association for Computational Linguistics (ACL 2000)</em> (2000)</p></li>
<li><p>H. Mann and D. Whitney, ‘On a Test of Whether one of Two Random Variables is Stochastically Larger than the Other’, in <em>Ann. Math. Statist.</em>, 1:18 (1947). <a class="reference external" href="https://doi.org/10.1214/aoms/1177730491">https://doi.org/10.1214/aoms/1177730491</a></p></li>
<li><p>Adam Kilgarriff, <em>Comparing Corpora</em>, in <em>International Journal of Corpus Linguistics</em>, 6:1 (2001). <a class="reference external" href="https://doi.org/10.1075/ijcl.6.1.05kil">https://doi.org/10.1075/ijcl.6.1.05kil</a></p></li>
</ul>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="exercises">
<h1>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h1>
<div class="section" id="exercise-9-1">
<h2>Exercise 9.1<a class="headerlink" href="#exercise-9-1" title="Permalink to this headline">¶</a></h2>
<p>Can you compare the diction of <em>Pride and Prejudice</em> using the Mann Whitney formula?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">dir</span> <span class="o">=</span> <span class="s1">&#39;Corpus&#39;</span>

<span class="n">corpus1</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;PrideandPrejudice.txt&#39;</span> <span class="p">]</span>
<span class="n">corpus2</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;Ulysses.txt&#39;</span> <span class="p">]</span>


<span class="k">def</span> <span class="nf">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">word_tokenize</span><span class="p">(</span><span class="n">full_text</span><span class="p">)</span>
    <span class="n">new_list</span><span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span> <span class="ow">and</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">:</span>
            <span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">w</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">new_list</span>


<span class="n">full_text1</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
<span class="n">full_text2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">corpus1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; ... &#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="nb">dir</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">full_text1</span> <span class="o">+=</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

<span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">corpus2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading &#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; ... &#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span> <span class="n">join</span><span class="p">(</span> <span class="nb">dir</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="p">)</span> <span class="k">as</span> <span class="n">file_handler</span><span class="p">:</span>
        <span class="n">full_text2</span> <span class="o">+=</span> <span class="n">file_handler</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">mannwhitneyu</span>

<span class="c1">## make a list of all the words in both corpora</span>
<span class="n">words1</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text1</span><span class="p">)</span>
<span class="n">words2</span> <span class="o">=</span> <span class="n">tokenise_remove_stopwords</span><span class="p">(</span><span class="n">full_text2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">divide_into_chunks</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>

    <span class="n">chunks</span><span class="o">=</span><span class="p">[]</span>
    <span class="c1">## chunk contains dictionaries</span>
    <span class="c1"># with word frequencies</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">),</span> <span class="n">length</span><span class="p">):</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
                <span class="n">word</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
                <span class="n">counts</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chunks</span>


<span class="n">length</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">chunks1</span> <span class="o">=</span> <span class="n">divide_into_chunks</span><span class="p">(</span><span class="n">words1</span><span class="p">,</span><span class="n">length</span><span class="p">)</span>
<span class="n">chunks2</span> <span class="o">=</span> <span class="n">divide_into_chunks</span><span class="p">(</span><span class="n">words2</span><span class="p">,</span><span class="n">length</span><span class="p">)</span>


<span class="c1"># vocab is the union of terms in both sets</span>
<span class="n">all_words</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks1</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">all_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="n">all_words</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks2</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
        <span class="n">all_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="n">all_words</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    
<span class="n">rho</span> <span class="o">=</span>  <span class="nb">dict</span><span class="p">()</span>
    
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">all_words</span><span class="p">:</span>
        
    <span class="n">a</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">b</span><span class="o">=</span><span class="p">[]</span>
        
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks1</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">chunks2</span><span class="p">:</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

    <span class="n">stat</span><span class="p">,</span><span class="n">pval</span><span class="o">=</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span>
    <span class="k">if</span> <span class="n">stat</span> <span class="o">&lt;=</span> <span class="n">mean</span><span class="p">:</span>
        <span class="n">pval</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="n">pval</span>
            
    <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">=</span> <span class="p">(</span> <span class="n">pval</span> <span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The following words are most distinctive in </span><span class="si">{</span><span class="n">corpus1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>  

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span> <span class="n">rho</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span> 
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">break</span>
            

<span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The following words are most distinctive in </span><span class="si">{</span><span class="n">corpus2</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>  

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nb">max</span> <span class="o">=</span> <span class="mi">25</span>

<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sortedByValue</span><span class="p">(</span> <span class="n">rho</span> <span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">rho</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s1">&#39;</span> <span class="p">)</span> 
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">max</span><span class="p">:</span>
            <span class="k">break</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cdsleiden/tdm-tutorial",
            ref: "gh-pages",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="8%20Lexicons.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">8. Lexicons</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Solutions/1%20Acquiring%20texts.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">1. Acquiring texts</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Peter Verhaar<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>